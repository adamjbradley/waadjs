// JayData 1.3.2
// Dual licensed under MIT and GPL v2
// Copyright JayStack Technologies (http://jaydata.org/licensing)
//
// JayData is a standards-based, cross-platform Javascript library and a set of
// practices to access and manipulate data from various online and offline sources.
//
// Credits:
//     Hajnalka Battancs, Dániel József, János Roden, László Horváth, Péter Nochta
//     Péter Zentai, Róbert Bónay, Szabolcs Czinege, Viktor Borza, Viktor Lázár,
//     Zoltán Gyebrovszki, Gábor Dolla
//
// More info: http://jaydata.org
Object.defineProperty($data.Entity.prototype,"_isNew",{get:function(){return!this.storeToken}});Object.defineProperty($data.Entity.prototype,"_isDirty",{get:function(){return!this._isNew&&this.changedProperties&&0<this.changedProperties.length}});var originalSave=$data.Entity.prototype.save,originalRemove=$data.Entity.prototype.remove,_getCacheKey=function(e){var e=e.expression.getJSON(),a=0,f,g;if(0==e.length)return a;for(f=0;f<e.length;f++)g=e.charCodeAt(f),a=(a<<5)-a+g,a&=a;return a};
angular.module("jaydata",["ng",function(e){e.factory("$data",function(a,f){var g={};$data.Entity.prototype.hasOwnProperty=function(a){var c;return this.getType&&this.getType().memberDefinitions?(c=this.getType().memberDefinitions["$"+a])?"property"===c.kind&&c.enumerable:!1:Object.prototype.hasOwnProperty.apply(this,arguments)};$data.Queryable.prototype.toLiveArray=function(d){function c(a,c){if(a){var d="success"===c?b.successHandlers:b.errorHandlers;"completed"===b.state?a(b):d.push(a);return b}}
var f=this;this.toTraceString();var e=_getCacheKey(this);if(g[e])return g[e];var b=[];g[e]=b;b.state="inprogress";b.successHandlers=[];b.errorHandlers=[];d&&"function"===typeof d&&c(d,"success");b.then=b.success=function(a){return c(a,"success")};b.error=function(){return b};b.refresh=function(a){b.length=0;b.state="inprogress";c(a,"success");f.toArray({success:b.resolve,error:b.reject});return b};b.resolve=function(c){b.state="completed";c.forEach(function(a){b.push(a)});b.successHandlers.forEach(function(a){a(b)});
a.$$phase||a.$apply()};b.reject=function(c){b.state="failed";b.errorHandlers.forEach(function(a){a(c)});a.$$phase||a.$apply()};this.toArray({success:b.resolve,error:b.reject});return b};$data.Entity.prototype.save=function(){var d=this,c=f.defer();originalSave.call(d).then(function(){g={};c.resolve(d);a.$$phase||a.$apply()}).fail(function(d){c.reject(d);a.$$phase||a.$apply()});return c.promise};$data.Entity.prototype.remove=function(){var d=f.defer(),c=this;originalRemove.call(c).then(function(){g=
{};d.resolve(c);a.$$phase||a.$apply()}).fail(function(c){d.reject(c);a.$$phase||a.$apply()});return d.promise};$data.EntityContext.prototype.liveSaveChanges=function(){var d=f.defer();this.saveChanges().then(function(c){g={};d.resolve(c);a.$$phase||a.$apply()}).fail(function(c){d.reject(c);a.$$phase||a.$apply()});return d.promise};return $data})}]);
